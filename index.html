<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Identity Forge</title>
  <meta name="description" content="Capture truths, hypotheses, and learning loops with Identity Forge." />
  <meta name="application-name" content="Identity Forge" />
  <meta name="theme-color" content="#ff6b35" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg-dark: #0a0a0a;
      --bg-card: #151515;
      --bg-elevated: #1a1a1a;
      --accent: #ff6b35;
      --accent-dim: #ff6b3533;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --text-dim: #666666;
      --border: #2a2a2a;
      --success: #00ff88;
      --warning: #ffaa00;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      padding: 0;
      margin: 0;
    }
    
    .app-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      text-align: center;
      padding: 60px 20px 40px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 40px;
    }
    
    .header h1 {
      font-size: 2.5rem;
      font-weight: 900;
      letter-spacing: -0.03em;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--accent) 0%, #ff8c61 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header .tagline {
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 500;
    }
    
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
      margin-bottom: 40px;
    }
    
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent);
      opacity: 0.5;
    }
    
    .stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-dim);
      margin-bottom: 8px;
      font-weight: 700;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 900;
      color: var(--accent);
      line-height: 1;
      margin-bottom: 4px;
    }
    
    .stat-trend {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    .nav-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 32px;
      background: var(--bg-card);
      padding: 6px;
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    
    .nav-tab {
      flex: 1;
      padding: 14px 20px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 0.95rem;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .nav-tab:hover {
      color: var(--text-primary);
      background: var(--bg-elevated);
    }
    
    .nav-tab.active {
      background: var(--accent);
      color: var(--bg-dark);
    }
    
    .view {
      display: none;
    }
    
    .view.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    
    .section-icon {
      font-size: 1.5rem;
    }
    
    .section-title {
      font-size: 1.1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-primary);
    }
    
    .truth-card {
      background: var(--bg-elevated);
      border-left: 4px solid var(--accent);
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .truth-text {
      font-size: 1.3rem;
      font-weight: 700;
      line-height: 1.4;
      margin-bottom: 16px;
      color: var(--text-primary);
    }
    
    .truth-question {
      font-size: 1rem;
      color: var(--text-secondary);
      font-style: italic;
      line-height: 1.6;
    }
    
    .question-block {
      margin-bottom: 32px;
    }
    
    .question-label {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
      display: block;
    }
    
    .question-hint {
      font-size: 0.9rem;
      color: var(--text-dim);
      margin-bottom: 16px;
      font-style: italic;
    }
    
    .input-text,
    .input-textarea {
      width: 100%;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px 16px;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }
    
    .input-text:focus,
    .input-textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-dark);
    }
    
    .input-textarea {
      min-height: 100px;
      resize: vertical;
      line-height: 1.6;
    }
    
    .slider-group {
      margin-bottom: 24px;
    }
    
    .slider-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .slider-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .slider-value {
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--accent);
    }
    
    .slider {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--bg-elevated);
      outline: none;
      -webkit-appearance: none;
      cursor: pointer;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }
    
    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      border: none;
      cursor: pointer;
    }
    
    .btn {
      width: 100%;
      padding: 16px 32px;
      background: var(--accent);
      color: var(--bg-dark);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 24px;
    }
    
    .btn:hover {
      background: #ff8c61;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px var(--accent-dim);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg-elevated);
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 20px;
    }
    
    .status-indicator.complete {
      background: rgba(0, 255, 136, 0.1);
      color: var(--success);
    }
    
    .status-indicator.pending {
      background: rgba(255, 170, 0, 0.1);
      color: var(--warning);
    }
    
    .history-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .history-item {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: transform 0.2s ease;
    }
    
    .history-item:hover {
      transform: translateX(4px);
      border-color: var(--accent);
    }
    
    .history-date {
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 12px;
      font-size: 0.95rem;
    }
    
    .history-content {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    .history-content strong {
      color: var(--text-primary);
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
    }
    
    .history-scores {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      font-size: 0.85rem;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-dim);
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.3;
    }
    
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--success);
      color: var(--bg-dark);
      padding: 16px 24px;
      border-radius: 8px;
      font-weight: 700;
      box-shadow: 0 8px 24px rgba(0, 255, 136, 0.3);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .yes-no-group {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .yes-no-btn {
      flex: 1;
      padding: 14px;
      background: var(--bg-elevated);
      border: 2px solid var(--border);
      border-radius: 8px;
      color: var(--text-secondary);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .yes-no-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }
    
    .yes-no-btn.selected {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg-dark);
    }
    
    @media (max-width: 640px) {
      .app-container {
        padding: 12px;
      }
      
      .header {
        padding: 40px 12px 30px;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .section {
        padding: 24px 20px;
      }
      
      .stats-bar {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="header">
      <h1>IDENTITY FORGE</h1>
      <p class="tagline">Your life matters. Your time is limited. Your future self is watching.</p>
    </header>
    
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-label">Vitality</div>
        <div class="stat-value" id="vitalityScore">--</div>
        <div class="stat-trend" id="vitalityTrend">Not yet tracked</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Courage</div>
        <div class="stat-value" id="courageScore">--</div>
        <div class="stat-trend" id="courageTrend">Not yet tracked</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Meaning</div>
        <div class="stat-value" id="meaningScore">--</div>
        <div class="stat-trend" id="meaningTrend">Not yet tracked</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Streak</div>
        <div class="stat-value" id="streakCount">0</div>
        <div class="stat-trend">Days</div>
      </div>
    </div>
    
    <nav class="nav-tabs">
      <button class="nav-tab active" onclick="switchView('morning')">Morning</button>
      <button class="nav-tab" onclick="switchView('evening')">Evening</button>
      <button class="nav-tab" onclick="switchView('history')">History</button>
    </nav>
    
    <!-- MORNING VIEW -->
    <div id="morning" class="view active">
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üî•</span>
          <h2 class="section-title">Wake-Up Truth</h2>
        </div>
        
        <div class="truth-card">
          <div class="truth-text" id="dailyTruth">Loading truth...</div>
          <div class="truth-question" id="dailyQuestion">Loading question...</div>
        </div>
        
        <div class="question-block">
          <label class="question-label">Your honest response:</label>
          <textarea class="input-textarea" id="truthResponse" placeholder="Write your answer..."></textarea>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span class="section-icon">‚ö°</span>
          <h2 class="section-title">Foundational Question</h2>
        </div>
        
        <div class="question-block">
          <label class="question-label" id="foundationalQuestion">Loading question...</label>
          <textarea class="input-textarea" id="foundationalResponse" placeholder="Your answer..."></textarea>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üéØ</span>
          <h2 class="section-title">Identity Declaration</h2>
        </div>
        
        <div class="question-block">
          <label class="question-label">Today I am the man who...</label>
          <p class="question-hint">One clear sentence. Declare who you're becoming.</p>
          <input type="text" class="input-text" id="identityDeclaration" placeholder="Today I am the man who..." />
        </div>
        
        <div class="question-block">
          <label class="question-label">One action to prove it:</label>
          <p class="question-hint">What specific thing will you do today?</p>
          <input type="text" class="input-text" id="proofAction" placeholder="I will..." />
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üìä</span>
          <h2 class="section-title">Quick Check</h2>
        </div>
        
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label">Energy Level</span>
            <span class="slider-value" id="energyValue">5</span>
          </div>
          <input type="range" min="1" max="10" value="5" class="slider" id="energySlider">
        </div>
        
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label">Optimism</span>
            <span class="slider-value" id="optimismValue">5</span>
          </div>
          <input type="range" min="1" max="10" value="5" class="slider" id="optimismSlider">
        </div>
        
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label">Confidence</span>
            <span class="slider-value" id="confidenceValue">5</span>
          </div>
          <input type="range" min="1" max="10" value="5" class="slider" id="confidenceSlider">
        </div>
      </div>
      
      <button class="btn" onclick="saveMorning()">Complete Morning</button>
    </div>
    
    <!-- EVENING VIEW -->
    <div id="evening" class="view">
      <div class="section">
        <div class="section-header">
          <span class="section-icon">‚úì</span>
          <h2 class="section-title">Accountability</h2>
        </div>
        
        <div class="question-block">
          <label class="question-label">Did you do what you said you'd do?</label>
          <p class="question-hint" id="actionReminder">Loading your commitment...</p>
          <div class="yes-no-group">
            <button class="yes-no-btn" id="didItYes" onclick="selectYesNo(true)">YES</button>
            <button class="yes-no-btn" id="didItNo" onclick="selectYesNo(false)">NO</button>
          </div>
          <textarea class="input-textarea" id="accountabilityWhy" placeholder="Why or why not? Be honest."></textarea>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üèÜ</span>
          <h2 class="section-title">Today's Win</h2>
        </div>
        
        <div class="question-block">
          <label class="question-label">What's one thing you did well today?</label>
          <p class="question-hint">No matter how small. Acknowledge it.</p>
          <textarea class="input-textarea" id="todayWin" placeholder="Today I..."></textarea>
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üìä</span>
          <h2 class="section-title">Evening Check</h2>
        </div>
        
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label">Overall Happiness</span>
            <span class="slider-value" id="happinessValue">5</span>
          </div>
          <input type="range" min="1" max="10" value="5" class="slider" id="happinessSlider">
        </div>
        
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label">Handled Challenges</span>
            <span class="slider-value" id="challengesValue">5</span>
          </div>
          <input type="range" min="1" max="10" value="5" class="slider" id="challengesSlider">
        </div>
        
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label">Felt Connected</span>
            <span class="slider-value" id="connectionValue">5</span>
          </div>
          <input type="range" min="1" max="10" value="5" class="slider" id="connectionSlider">
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üîÆ</span>
          <h2 class="section-title">Tomorrow</h2>
        </div>
        
        <div class="question-block">
          <label class="question-label">What's your focus for tomorrow?</label>
          <p class="question-hint">One clear priority.</p>
          <input type="text" class="input-text" id="tomorrowFocus" placeholder="Tomorrow I will focus on..." />
        </div>
      </div>
      
      <button class="btn" onclick="saveEvening()">Complete Evening</button>
    </div>
    
    <!-- HISTORY VIEW -->
    <div id="history" class="view">
      <div class="section">
        <div class="section-header">
          <span class="section-icon">üìú</span>
          <h2 class="section-title">Your Journey</h2>
        </div>
        
        <div class="history-list" id="historyList">
          <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <p>No entries yet. Complete your first check-in to start.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script>
    // Wake-up truths and questions
    const truths = [
      {
        truth: "You are the youngest you will ever be.",
        question: "If today is the youngest, strongest version of you that will ever exist, what will you do with it that your older self will thank you for?"
      },
      {
        truth: "Every day might be your last.",
        question: "If today was the final page of your life, how would you want the story to end by midnight?"
      },
      {
        truth: "You are wealthier than most of the world.",
        question: "With the level of wealth, safety, and freedom you have, what excuse do you actually have to play small?"
      },
      {
        truth: "You have opportunities people would kill for.",
        question: "If someone with nothing had your life for 24 hours, how much harder would they push than you?"
      },
      {
        truth: "Your life is not guaranteed beyond today.",
        question: "If life was borrowed time, how would you spend the next twelve hours?"
      }
    ];
    
    // Foundational questions (rotating)
    const foundationalQuestions = [
      "Are you healthy today? If yes, what is stopping you from using this body fully?",
      "Is there someone who would stand at your funeral even if it rained? If not, how will you build relationships worth dying for?",
      "If you were gone tonight, what would people say about your life? Is that acceptable to you?",
      "What is one thing you can do today so that by bedtime, you feel genuine pride instead of regret?",
      "What fear or insecurity will you confront today that will raise your character one level higher?"
    ];
    
    // State management
    let entries = [];
    let currentDayIndex = 0;
    let eveningDidIt = null;
    
    // Initialize
    function init() {
      setupSliders();
      loadDailyContent();
      updateStats();
      checkEveningAvailability();
    }
    
    // Setup slider value displays
    function setupSliders() {
      const sliders = [
        {id: 'energySlider', valueId: 'energyValue'},
        {id: 'optimismSlider', valueId: 'optimismValue'},
        {id: 'confidenceSlider', valueId: 'confidenceValue'},
        {id: 'happinessSlider', valueId: 'happinessValue'},
        {id: 'challengesSlider', valueId: 'challengesValue'},
        {id: 'connectionSlider', valueId: 'connectionValue'}
      ];
      
      sliders.forEach(({id, valueId}) => {
        const slider = document.getElementById(id);
        const valueDisplay = document.getElementById(valueId);
        if (slider && valueDisplay) {
          slider.addEventListener('input', (e) => {
            valueDisplay.textContent = e.target.value;
          });
        }
      });
    }
    
    // Load daily rotating content
    function loadDailyContent() {
      const dayOfYear = Math.floor((Date.now() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
      const truthIndex = dayOfYear % truths.length;
      const questionIndex = dayOfYear % foundationalQuestions.length;
      
      currentDayIndex = dayOfYear;
      
      document.getElementById('dailyTruth').textContent = truths[truthIndex].truth;
      document.getElementById('dailyQuestion').textContent = truths[truthIndex].question;
      document.getElementById('foundationalQuestion').textContent = foundationalQuestions[questionIndex];
    }
    
    // Check if evening is available
    function checkEveningAvailability() {
      const today = getTodayEntries();
      if (today.morning) {
        document.getElementById('actionReminder').textContent = `You said: "${today.morning.proofAction}"`;
      }
    }
    
    // Get today's entries
    function getTodayEntries() {
      const today = new Date().toDateString();
      return {
        morning: entries.find(e => e.type === 'morning' && new Date(e.date).toDateString() === today),
        evening: entries.find(e => e.type === 'evening' && new Date(e.date).toDateString() === today)
      };
    }
    
    // Switch view
    function switchView(viewName) {
      const tabs = document.querySelectorAll('.nav-tab');
      const views = document.querySelectorAll('.view');
      
      tabs.forEach(tab => tab.classList.remove('active'));
      views.forEach(view => view.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(viewName).classList.add('active');
      
      if (viewName === 'evening') {
        checkEveningAvailability();
      } else if (viewName === 'history') {
        displayHistory();
      }
    }
    
    // Yes/No selection
    function selectYesNo(value) {
      eveningDidIt = value;
      document.getElementById('didItYes').classList.toggle('selected', value === true);
      document.getElementById('didItNo').classList.toggle('selected', value === false);
    }
    
    // Save morning
    function saveMorning() {
      const data = {
        date: new Date().toISOString(),
        type: 'morning',
        dayIndex: currentDayIndex,
        truthResponse: document.getElementById('truthResponse').value,
        foundationalResponse: document.getElementById('foundationalResponse').value,
        identityDeclaration: document.getElementById('identityDeclaration').value,
        proofAction: document.getElementById('proofAction').value,
        energy: parseInt(document.getElementById('energySlider').value),
        optimism: parseInt(document.getElementById('optimismSlider').value),
        confidence: parseInt(document.getElementById('confidenceSlider').value)
      };
      
      // Validate
      if (!data.truthResponse || !data.foundationalResponse || !data.identityDeclaration || !data.proofAction) {
        showToast('Please complete all fields');
        return;
      }
      
      // Remove old morning entry for today
      const today = new Date().toDateString();
      entries = entries.filter(e => !(e.type === 'morning' && new Date(e.date).toDateString() === today));
      
      entries.push(data);
      saveToStorage();
      showToast('Morning complete. Make it count.');
      updateStats();
      
      // Clear form
      document.getElementById('truthResponse').value = '';
      document.getElementById('foundationalResponse').value = '';
      document.getElementById('identityDeclaration').value = '';
      document.getElementById('proofAction').value = '';
    }
    
    // Save evening
    function saveEvening() {
      const todayMorning = getTodayEntries().morning;
      
      if (!todayMorning) {
        showToast('Complete your morning check-in first');
        return;
      }
      
      if (eveningDidIt === null) {
        showToast('Please select Yes or No for accountability');
        return;
      }
      
      const data = {
        date: new Date().toISOString(),
        type: 'evening',
        dayIndex: currentDayIndex,
        didIt: eveningDidIt,
        accountabilityWhy: document.getElementById('accountabilityWhy').value,
        todayWin: document.getElementById('todayWin').value,
        happiness: parseInt(document.getElementById('happinessSlider').value),
        challenges: parseInt(document.getElementById('challengesSlider').value),
        connection: parseInt(document.getElementById('connectionSlider').value),
        tomorrowFocus: document.getElementById('tomorrowFocus').value
      };
      
      // Validate
      if (!data.accountabilityWhy || !data.todayWin || !data.tomorrowFocus) {
        showToast('Please complete all fields');
        return;
      }
      
      // Remove old evening entry for today
      const today = new Date().toDateString();
      entries = entries.filter(e => !(e.type === 'evening' && new Date(e.date).toDateString() === today));
      
      entries.push(data);
      saveToStorage();
      showToast('Evening complete. Rest well.');
      updateStats();
      
      // Clear form
      eveningDidIt = null;
      document.getElementById('didItYes').classList.remove('selected');
      document.getElementById('didItNo').classList.remove('selected');
      document.getElementById('accountabilityWhy').value = '';
      document.getElementById('todayWin').value = '';
      document.getElementById('tomorrowFocus').value = '';
    }
    
    // Calculate stats
    function updateStats() {
      if (entries.length === 0) return;
      
      const morningEntries = entries.filter(e => e.type === 'morning');
      const eveningEntries = entries.filter(e => e.type === 'evening');
      
      // Calculate Vitality (energy + optimism)
      let vitalityScores = [];
      morningEntries.forEach(e => {
        vitalityScores.push((e.energy + e.optimism) / 2);
      });
      const vitality = vitalityScores.length > 0 
        ? (vitalityScores.reduce((a, b) => a + b, 0) / vitalityScores.length).toFixed(1)
        : '--';
      
      // Calculate Courage (confidence + challenges handled + did what you said)
      let courageScores = [];
      morningEntries.forEach(e => courageScores.push(e.confidence));
      eveningEntries.forEach(e => {
        courageScores.push(e.challenges);
        courageScores.push(e.didIt ? 10 : 5); // Bonus for following through
      });
      const courage = courageScores.length > 0
        ? (courageScores.reduce((a, b) => a + b, 0) / courageScores.length).toFixed(1)
        : '--';
      
      // Calculate Meaning (happiness + connection)
      let meaningScores = [];
      eveningEntries.forEach(e => {
        meaningScores.push((e.happiness + e.connection) / 2);
      });
      const meaning = meaningScores.length > 0
        ? (meaningScores.reduce((a, b) => a + b, 0) / meaningScores.length).toFixed(1)
        : '--';
      
      // Calculate streak
      const streak = calculateStreak();
      
      // Update display
      document.getElementById('vitalityScore').textContent = vitality;
      document.getElementById('courageScore').textContent = courage;
      document.getElementById('meaningScore').textContent = meaning;
      document.getElementById('streakCount').textContent = streak;
      
      // Update trends (last 7 days average)
      updateTrends();
    }
    
    // Calculate streak
    function calculateStreak() {
      const today = new Date();
      let streak = 0;
      
      for (let i = 0; i < 365; i++) {
        const checkDate = new Date(today);
        checkDate.setDate(checkDate.getDate() - i);
        const dateStr = checkDate.toDateString();
        
        const hasBoth = entries.some(e => e.type === 'morning' && new Date(e.date).toDateString() === dateStr) &&
                       entries.some(e => e.type === 'evening' && new Date(e.date).toDateString() === dateStr);
        
        if (hasBoth) {
          streak++;
        } else {
          break;
        }
      }
      
      return streak;
    }
    
    // Update trends
    function updateTrends() {
      const trends = {
        vitality: 'Building energy',
        courage: 'Growing stronger',
        meaning: 'Finding purpose'
      };
      
      document.getElementById('vitalityTrend').textContent = trends.vitality;
      document.getElementById('courageTrend').textContent = trends.courage;
      document.getElementById('meaningTrend').textContent = trends.meaning;
    }
    
    // Display history
    function displayHistory() {
      const historyList = document.getElementById('historyList');
      
      if (entries.length === 0) {
        historyList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <p>No entries yet. Complete your first check-in to start.</p>
          </div>
        `;
        return;
      }
      
      // Group by date
      const grouped = {};
      entries.forEach(entry => {
        const dateKey = new Date(entry.date).toDateString();
        if (!grouped[dateKey]) grouped[dateKey] = {};
        grouped[dateKey][entry.type] = entry;
      });
      
      // Sort by date descending
      const sortedDates = Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a));
      
      historyList.innerHTML = sortedDates.slice(0, 30).map(dateStr => {
        const day = grouped[dateStr];
        const date = new Date(dateStr);
        const formattedDate = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
        
        return `
          <div class="history-item">
            <div class="history-date">${formattedDate}</div>
            ${day.morning ? `
              <div class="history-content">
                <strong>Identity:</strong> ${day.morning.identityDeclaration}
                <strong>Action:</strong> ${day.morning.proofAction}
              </div>
            ` : ''}
            ${day.evening ? `
              <div class="history-content">
                <strong>Did it?</strong> ${day.evening.didIt ? 'YES ‚úì' : 'NO'}
                <strong>Win:</strong> ${day.evening.todayWin}
              </div>
            ` : ''}
            ${day.morning && day.evening ? `
              <div class="history-scores">
                <span>Vitality: ${((day.morning.energy + day.morning.optimism) / 2).toFixed(1)}</span>
                <span>Courage: ${day.morning.confidence}</span>
                <span>Meaning: ${((day.evening.happiness + day.evening.connection) / 2).toFixed(1)}</span>
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }
    
    // Storage (in-memory for artifacts)
    function saveToStorage() {
      window.identityForgeData = JSON.stringify(entries);
    }
    
    function loadFromStorage() {
      if (window.identityForgeData) {
        try {
          entries = JSON.parse(window.identityForgeData);
        } catch (e) {
          entries = [];
        }
      }
    }
    
    // Toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // Initialize on load
    loadFromStorage();
    init();
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js').catch((error) => {
          console.error('Service worker registration failed', error);
        });
      });
    }
  </script>
</body>
</html>
